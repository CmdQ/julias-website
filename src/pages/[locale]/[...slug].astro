---
import type { GetStaticPaths } from 'astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

type Props = {
	entry: Awaited<ReturnType<typeof getCollection<'pages'>>>[number];
};

export const getStaticPaths = (async () => {
	const allPages = await getCollection('pages');

	return allPages.map(entry => {
		// Extract locale and page name from id like 'en/index.md' or 'de/contact.md'
		const [locale, ...rest] = entry.id.split('/');
		const pageName = rest.join('/').replace('.md', '');
		// For index, use undefined (becomes /locale/), for others use the page name
		const slug = pageName === 'index' ? undefined : pageName;

		return {
			params: { locale, slug },
			props: { entry },
		};
	});
}) satisfies GetStaticPaths;

const { entry } = Astro.props as Props;
const { Content } = await entry.render();

const lang = Astro.params.locale as 'en' | 'de';
const currentPath = Astro.url.pathname;
// Generate alternate path by swapping the locale
const otherLocale = lang === 'en' ? 'de' : 'en';
const alternatePath = currentPath.replace(`/${lang}/`, `/${otherLocale}/`);

const alternates = {
	[otherLocale]: alternatePath,
};
---
<BaseLayout lang={lang} title={entry.data.title} description={entry.data.description} alternates={alternates}>
	<article class="prose">
		<Content />
	</article>
</BaseLayout>
