---
import '../styles/global.css';

interface AlternateLinks {
	en?: string;
	de?: string;
}

interface Props {
	lang: 'en' | 'de';
	title: string;
	description?: string;
	alternates?: AlternateLinks;
}

const siteName = "Julia's Portfolio";
const { lang, title, description, alternates = {} }: Props = Astro.props;
const pageTitle = title ? `${title} ¬∑ ${siteName}` : siteName;

// Normalize base URL - remove trailing slash to avoid double slashes
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const localeNav = {
	en: [
		{ href: `${base}/en/`, label: 'Home' },
		{ href: `${base}/en/about-me/`, label: 'About me' },
		{ href: `${base}/en/contact/`, label: 'Contact' },
		{ href: `${base}/en/project-futopia/`, label: 'Project Futopia' },
		{ href: `${base}/en/climate-education/`, label: 'Climate Education' },
		{ href: `${base}/en/creative-projects/`, label: 'Creative Projects' },
	],
	de: [
		{ href: `${base}/de/`, label: 'Home' },
		{ href: `${base}/de/about-me/`, label: 'About me' },
		{ href: `${base}/de/contact/`, label: 'Kontakt' },
		{ href: `${base}/de/project-futopia/`, label: 'Projekt Futopia' },
		{ href: `${base}/de/climate-education/`, label: 'Climate Education' },
		{ href: `${base}/de/creative-projects/`, label: 'Kreative Projekte' },
	],
} as const;

const navItems = localeNav[lang];
const otherLocale = lang === 'en' ? 'de' : 'en';
const switchHref = alternates[otherLocale] ?? `${base}/${otherLocale}/`;
const canonical = Astro.site ? new URL(Astro.url.pathname, Astro.site).toString() : undefined;
const currentPath = Astro.url.pathname;

// Build hreflang alternates
const hreflangAlternates = {
	en: alternates.en ?? `${base}/en/`,
	de: alternates.de ?? `${base}/de/`,
};
---
<!DOCTYPE html>
<html lang={lang} class="min-h-full">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="generator" content={Astro.generator} />
		<title>{pageTitle}</title>
		{canonical && <link rel="canonical" href={canonical} />}
		{description && <meta name="description" content={description} />}
		{Object.entries(hreflangAlternates).map(([locale, href]) => (
			<link rel="alternate" hreflang={locale} href={href} />
		))}
		<link rel="icon" type="image/svg+xml" href={`${base}/favicon.svg`} />
	</head>
	<body class="min-h-screen" style="background-color: rgb(10, 24, 34);">
		<div class="mx-auto max-w-5xl" style="background-color: var(--color-bg-cream);">

	<!-- Hero Image - scrolls away -->
	<div class="relative w-full overflow-hidden">
		<img
			src={`${base}/images/hero.jpg`}
			alt="Julia Salomon - Educator and Artist"
			class="w-full h-auto"
		/>
	</div>		<!-- Navigation Wrapper -->
		<!-- Mobile: display: contents (children act as direct siblings of main container) -->
		<!-- Desktop: sticky header flex row -->
		<div class="contents sm:sticky sm:top-0 sm:z-40 sm:flex sm:w-full sm:flex-row sm:items-center sm:justify-between sm:px-4 sm:py-2 lg:px-6 lg:py-8" style="background-color: var(--color-highlight);">

			<!-- Name Section -->
			<div class="w-full px-4 py-4 sm:w-auto sm:p-0" style="background-color: var(--color-highlight);">
				<p class="text-xs sm:text-sm uppercase tracking-[0.2em] font-bold" style="color: var(--color-text-dark); opacity: 0.7;">Climate Communicator</p>
				<h1 class="m-0 text-3xl sm:text-4xl font-black drop-shadow-sm" style="color: var(--color-text-dark);">Julia Salomon</h1>
			</div>

			<!-- Nav Section -->
			<nav
				aria-label={lang === 'en' ? 'Primary' : 'Hauptnavigation'}
				class="sticky top-0 z-40 grid w-full grid-cols-2 gap-2 px-4 py-2 shadow-md sm:static sm:w-auto sm:grid-cols-3 sm:gap-4 sm:p-0 sm:shadow-none"
				style="background-color: var(--color-highlight);"
			>
				{navItems.map((item) => {
					const isActive = currentPath === item.href || currentPath === item.href.replace(/\/$/, '');
					return (
					<a
						class="group rounded-xl px-3 py-2 text-center text-sm font-bold transition-all duration-300 hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 border backdrop-blur-sm lg:px-4 lg:py-3 lg:text-base"
						style={isActive
							? "color: var(--color-text-dark); border-color: var(--color-text-dark); background-color: color-mix(in srgb, var(--color-white) 70%, transparent); --tw-ring-color: var(--color-text-dark);"
							: "color: var(--color-text-dark); border-color: color-mix(in srgb, var(--color-text-dark) 20%, transparent); background-color: color-mix(in srgb, var(--color-white) 30%, transparent); --tw-ring-color: var(--color-text-dark);"}
						href={item.href}
						aria-current={isActive ? 'page' : undefined}
					>
						{item.label}
					</a>
				)})}
			</nav>
		</div>
		<main id="main-content" class="w-full px-6 py-12 sm:px-12">
			<slot />
		</main>
		<footer style="background-color: var(--color-bg-cream);">
			<div class="flex w-full flex-col gap-4 px-6 py-8 sm:flex-row sm:items-center sm:justify-between">
				<p class="m-0 text-sm" style="color: var(--color-text-dark); opacity: 0.7;">¬© {new Date().getFullYear()} Julia Salomon</p>
				<div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-6">
				<a class="text-sm font-semibold hover:underline" style="color: var(--color-text-dark);" href={lang === 'en' ? `${base}/en/privacy/` : `${base}/de/privacy/`}>
					{lang === 'en' ? 'Privacy Notice' : 'Datenschutz'}
				</a>
					<a class="inline-flex items-center gap-2 text-sm font-semibold" style="color: var(--color-text-dark);" href={switchHref}>
						<span aria-hidden="true">üåê</span>
						{lang === 'en' ? 'Deutsch' : 'English'}
					</a>
				</div>
			</div>
		</footer>
		</div>
	</body>
</html>
